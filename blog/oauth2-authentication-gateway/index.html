<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>IMPLEMENTING ZERO-TRUST AUTHENTICATION WITH OAUTH2-PROXY</title>
		<meta name="description" content="Jay Singh&#39;s portfolio - Software Engineer">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Jay Singh">
		
		
		<link rel="stylesheet" href="/css/main.css">
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #082840;
	--text-color-link-active: #5f2b48;
	--text-color-link-visited: #17050F;

	--syntax-tab-size: 2;
}

/* Dark mode removed - brutalist design uses cream-based light theme only */

/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
main :first-child {
	margin-top: 0;
}

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

/* Skip link styling moved to main.css using Tailwind utilities (.skip-link class) */

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
}
pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: .5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
	padding-left: 1.5rem;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	content: "" counter(start-from, decimal-leading-zero) ". ";
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	padding-left: .25em;
	padding-right: .5em;
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	text-transform: capitalize;
	font-style: italic;
}
.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}
/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}</style>
		
	</head>
	<body>
		<a href="#main-content" id="skip-link" class="skip-link">Skip to main content</a>

		<header role="banner">
			<a href="/" class="home-link">Jay Singh</a>
			<nav aria-label="Main navigation">
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/feed/feed.xml">Feed</a></li>
				</ul>
			</nav>
		</header>

		<main id="main-content" tabindex="-1">
			<heading-anchors>
				


<h1 id="implementing-zero-trust-authentication-with-oauth2-proxy">IMPLEMENTING ZERO-TRUST AUTHENTICATION WITH OAUTH2-PROXY</h1>

<ul class="post-metadata">
	<li><time datetime="2024-10-15">15 October 2024</time></li>
	<li><a href="/tags/oauth2/" class="post-tag">oauth2</a>, </li>
	<li><a href="/tags/security/" class="post-tag">security</a>, </li>
	<li><a href="/tags/authentication/" class="post-tag">authentication</a>, </li>
	<li><a href="/tags/devops/" class="post-tag">devops</a></li>
</ul>

<p>Modern web applications require robust authentication and authorization. A zero-trust architecture ensures every request is authenticated and authorized before accessing protected resources. Here's how we built an authentication gateway serving 5,181+ active users.</p>
<h2 id="the-zero-trust-architecture">The Zero-Trust Architecture</h2>
<p>OAuth2-Proxy acts as a reverse proxy that handles authentication before requests reach your application. Combined with Traefik as the ingress controller, you can protect entire services with just configuration changes. This pattern keeps authentication logic out of individual applications.</p>
<pre class="language-mermaid" tabindex="0"><code class="language-mermaid"><span class="token keyword">graph</span> LR
    A<span class="token text string">[User]</span> <span class="token arrow operator">--></span> B<span class="token text string">[Traefik Ingress]</span>
    B <span class="token arrow operator">--></span> C<span class="token text string">[OAuth2-Proxy]</span>
    C <span class="token arrow operator">--></span> D<span class="token text string">{Authenticated?}</span>
    D <span class="token arrow operator">--></span><span class="token label property">|No|</span> E<span class="token text string">[Keycloak SSO]</span>
    E <span class="token arrow operator">--></span> A
    D <span class="token arrow operator">--></span><span class="token label property">|Yes|</span> F<span class="token text string">[Protected Service]</span>
    F <span class="token arrow operator">--></span> G<span class="token text string">[PostgreSQL]</span>
    C <span class="token arrow operator">--></span> H<span class="token text string">[Redis Session Store]</span></code></pre>
<h2 id="keycloak-for-centralized-identity">Keycloak for Centralized Identity</h2>
<p>Keycloak provides centralized identity management with SSO capabilities. Users log in once and access multiple applications seamlessly. It supports various authentication methods, role-based access control, and integrates with existing identity providers.</p>
<pre class="language-yaml" tabindex="0"><code class="language-yaml"><span class="token key atrule">upstreams</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> protected<span class="token punctuation">-</span>service
    <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//backend<span class="token punctuation">:</span><span class="token number">8000</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /

<span class="token key atrule">providers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> keycloak
    <span class="token key atrule">provider</span><span class="token punctuation">:</span> oidc
    <span class="token key atrule">clientID</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>app
    <span class="token key atrule">clientSecret</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>CLIENT_SECRET<span class="token punctuation">}</span>
    <span class="token key atrule">oidcConfig</span><span class="token punctuation">:</span>
      <span class="token key atrule">issuerURL</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//keycloak.example.com/realms/myrealm
      <span class="token key atrule">audienceClaims</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> aud
      <span class="token key atrule">emailClaim</span><span class="token punctuation">:</span> email
      <span class="token key atrule">groupsClaim</span><span class="token punctuation">:</span> groups</code></pre>
<h2 id="implementation-details">Implementation Details</h2>
<p>The implementation consists of several key components working together:</p>
<h3 id="oauth2-proxy-deployment">OAuth2-Proxy Deployment</h3>
<p>Deploy OAuth2-Proxy as a sidecar container alongside your application. Configure it to validate tokens with Keycloak and maintain session state in Redis for horizontal scalability.</p>
<h3 id="traefik-middleware-configuration">Traefik Middleware Configuration</h3>
<pre class="language-yaml" tabindex="0"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> traefik.containo.us/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Middleware
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> auth<span class="token punctuation">-</span>middleware
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">forwardAuth</span><span class="token punctuation">:</span>
    <span class="token key atrule">address</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//oauth2<span class="token punctuation">-</span>proxy<span class="token punctuation">:</span>4180/oauth2/auth
    <span class="token key atrule">trustForwardHeader</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">authResponseHeaders</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> X<span class="token punctuation">-</span>Auth<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>User
      <span class="token punctuation">-</span> X<span class="token punctuation">-</span>Auth<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Email
      <span class="token punctuation">-</span> X<span class="token punctuation">-</span>Auth<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Groups</code></pre>
<h3 id="role-based-access-control">Role-Based Access Control</h3>
<p>Set up Keycloak realms and clients with appropriate roles. Implement RBAC by checking group membership in your application. OAuth2-Proxy passes user groups via headers for fine-grained authorization.</p>
<blockquote>
<p><strong>Warning:</strong> Always validate authorization in your application layer, even with OAuth2-Proxy. Defense in depth is essential for security.</p>
</blockquote>
<h2 id="security-best-practices">Security Best Practices</h2>
<p>Security must be built into every layer of your authentication system:</p>
<pre class="language-yaml" tabindex="0"><code class="language-yaml"><span class="token key atrule">headers</span><span class="token punctuation">:</span>
  <span class="token key atrule">customResponseHeaders</span><span class="token punctuation">:</span>
    <span class="token key atrule">Strict-Transport-Security</span><span class="token punctuation">:</span> <span class="token string">"max-age=63072000"</span>
    <span class="token key atrule">X-Frame-Options</span><span class="token punctuation">:</span> <span class="token string">"DENY"</span>
    <span class="token key atrule">X-Content-Type-Options</span><span class="token punctuation">:</span> <span class="token string">"nosniff"</span>
    <span class="token key atrule">Referrer-Policy</span><span class="token punctuation">:</span> <span class="token string">"strict-origin-when-cross-origin"</span>
    <span class="token key atrule">Permissions-Policy</span><span class="token punctuation">:</span> <span class="token string">"geolocation=(), microphone=(), camera=()"</span>
  <span class="token key atrule">contentSecurityPolicy</span><span class="token punctuation">:</span> <span class="token string">"default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'"</span></code></pre>
<p>Always use HTTPS in production. Implement CSRF protection for state-changing operations. Set proper CORS headers to prevent unauthorized cross-origin requests. Use short-lived access tokens (15 minutes) with refresh tokens for extended sessions. Monitor authentication failures and implement rate limiting to prevent brute force attacks.</p>
<blockquote>
<p><strong>Important:</strong> Store session data in Redis with appropriate TTLs. Never store sensitive data in browser storage. Use httpOnly, secure, and sameSite cookies.</p>
</blockquote>
<h2 id="real-world-results">Real-World Results</h2>
<p>Our authentication gateway protects 11 microservices and serves 5,181+ active users. The zero-trust architecture ensures every request is validated while providing seamless SSO experience. Users authenticate once and access all applications without repeated logins.</p>
<blockquote>
<p><strong>Tip:</strong> With proper monitoring, we detected and blocked 200+ unauthorized access attempts in the first month. Security monitoring is not optional.</p>
</blockquote>
<p>The result: a secure, scalable authentication system that protects sensitive university data while providing seamless user experience across multiple applications. Response times remain under 100ms for authenticated requests, and the system scales horizontally to handle traffic spikes.</p>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/blog/docker-observability/">COMPREHENSIVE OBSERVABILITY FOR DOCKER MICROSERVICES</a></li><li class="links-nextprev-next">Next →<br><a href="/blog/building-fastapi-microservices/">BUILDING EVENT-DRIVEN MICROSERVICES WITH FASTAPI</a></li>
</ul>

			</heading-anchors>
		</main>

		<footer role="contentinfo">
			<p>
				<em>Built with <a href="https://www.11ty.dev/">Eleventy v3.1.2</a></em>
			</p>
		</footer>

		<!-- This page `/blog/oauth2-authentication-gateway/` was built on 2026-01-29T15:29:27.723Z -->
		<script type="module" src="/dist/cC8wS6ZjFU.js"></script>
	</body>
</html>
